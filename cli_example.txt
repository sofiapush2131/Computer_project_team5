# 1. Загальна ідея

Ця програма — невеликий CLI (інтерфейс командного рядка) для демонстрації трьох режимів роботи з рекомендаціями і PageRank на простому графі користувачів і пісень:

* Режим **рекомендацій для конкретного користувача** (`--user`)
* Режим **виводу PageRank для всіх вузлів** (`--pagerank`)
* Режим **виводу зв'язків графа** (`--graph`)

Дані (списки `users`, `items`, `interactions`) зараз жорстко вбудовані в код.

---

# 2. Структура коду — крок за кроком

1. Імпорт:

```python
import argparse
from pagerank import (
    build_interaction_graph,
    pagerank,
    recommend,
)
```

* `argparse` — бібліотека для розбору аргументів командного рядка.
* `build_interaction_graph`, `pagerank`, `recommend` — функції з твого модуля `pagerank` (будують граф, рахує PageRank, дає рекомендації).

2. Дані:

```python
users = ['user1', 'user2', 'user3']
items = ['songA', 'songB', 'songC', 'songD']

interactions = [
    ('user1', 'songA'),
    ('user1', 'songB'),
    ('user2', 'songA'),
    ('user3', 'songC'),
]
```

* `users` — список користувачів.
* `items` — список пісень.
* `interactions` — пари (користувач, пісня) — граф взаємодій.

3. Функція `main()` створює парсер аргументів:

```python
parser = argparse.ArgumentParser(description='Recommendation System CLI')
```

4. Додає аргументи (параметри), які користувач може вказати у командному рядку (деталі — нижче).

5. Читає аргументи:

```python
args = parser.parse_args()
```

`args` — об’єкт з полями для всіх аргументів (`args.user`, `args.pagerank`, тощо).

6. Будує граф:

```python
matrix, index, all_nodes = build_interaction_graph(items, users, interactions)
```

* `matrix` — матриця суміжності (або інше представлення) графа.
* `index` — словник, що мапить ідентифікатори (user/song) → індекс у матриці.
* `all_nodes` — список всіх вузлів у порядку індексів.

7. Три основні блоки (режими) — виконуються по черзі. Як тільки один спрацює, програма завершується (`return`).

---

## Блок 1 — рекомендації для користувача

```python
if args.user:
    if args.user not in users:
        print(f'User {args.user} not found.')
        return

    rank = pagerank(matrix, d=args.damping, max_iter=args.max_iter)
    recs = recommend(args.user, rank, index, all_nodes, top_k=args.top)

    print(f'Recommendations for {args.user}:')
    for item, score in recs:
        print(f'{item}: {score:.4f}')
    return
```

* Виконується, якщо в команді вказано `--user <ім'я>`.
* Перевіряє, чи існує такий користувач.
* Обчислює PageRank (з параметрами `damping` і `max_iter`).
* Викликає `recommend(...)` щоб отримати `top_k` рекомендацій для цього користувача.
* Друкує список рекомендацій зі значеннями PageRank.

---

## Блок 2 — PageRank для всіх вузлів

```python
if args.pagerank:
    rank = pagerank(matrix, d=args.damping, max_iter=args.max_iter)

    print('PageRank values:')
    for node, idx in index.items():
        print(f'{node}: {rank[idx]:.4f}')
    return
```

* Виконується, якщо в команді вказано `--pagerank`.
* Обчислює PageRank для всіх вузлів і друкує їх значення.

---

## Блок 3 — вивід графа

```python
if args.graph:
    print('Graph:')
    for u, i in interactions:
        print(f'{u} -> {i}')
    return
```

* Виконується при `--graph`.
* Просто друкує список зв’язків `user -> song`.

---

8. Якщо не вказано жодного режиму — показує допомогу:

```python
parser.print_help()
```

9. Виклик `main()` при старті скрипта:

```python
if __name__ == '__main__':
    main()
```

---

# 3. Що означають параметри (аргументи) — дуже просто

* `--user <ім'я>`
  Вказує, для якого користувача потрібно вивести рекомендації.
  Приклад:

  ```
  python CLI.py --user user1 --top 3
  ```

  Значення доступне в коді як `args.user` (рядок).

* `--top <N>`
  Скільки рекомендацій вивести (Top-K). За замовчуванням `5`.
  Приклад: `--top 3` → `args.top == 3`.

* `--pagerank`
  Прапорець (flag). Якщо вказаний — програма друкує PageRank для всіх вузлів.
  Використовується як `if args.pagerank:` (булеве значення True/False).

* `--damping <float>`
  Фактор телепортації (d) для PageRank. Зазвичай між 0 і 1, стандартно `0.85`.
  Використовується в виклику `pagerank(matrix, d=args.damping, ...)`.

* `--max-iter <int>`
  Максимальна кількість ітерацій для алгоритму PageRank (щоб зупинитися, якщо не збігається швидко). За замовчуванням `100`.

* `--graph`
  Прапорець. Якщо вказаний — програма виводить список зв’язків `user -> item`.

---

# 4. Приклади запуску і що вони роблять

1. `python CLI.py --user user1 --top 3`
   — обчислить PageRank, надасть 3 рекомендації для `user1`.

2. `python CLI.py --pagerank --damping 0.9`
   — обчислить PageRank з `d = 0.9` і виведе значення для всіх вузлів.

3. `python CLI.py --graph`
   — виведе всі `user -> item` з `interactions`.

---

# 5. Короткі пояснення викликів функцій з `pagerank` (щоб усе зрозуміти)

* `build_interaction_graph(items, users, interactions)` — будує граф (матрицю + індекси) з перерахованих взаємодій.
* `pagerank(matrix, d=..., max_iter=...)` — обчислює PageRank-вектор для вузлів графа.
* `recommend(user, rank, index, all_nodes, top_k=...)` — на основі PageRank і структури графа повертає `top_k` рекомендованих елементів для вказаного користувача.

---

# 6. Що змінити, якщо захочеш розширити

* Зчитувати `users`, `items`, `interactions` з CSV/JSON (передати шлях через `--data`).
* Додати режим, що виводить DOT або візуалізацію графа.
* Зберігати результати у файл замість друку на екран.

---

Якщо хочеш, поясню 1) як виглядає `index` (mapping node→індекс) або 2) що саме робить `recommend()` — скажи, поясню точно й просто.
